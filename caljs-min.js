//////////////////////////////////////////////////////////////////////////////////////
//
//	Copyright 2012 Piotr Walczyszyn (http://outof.me | @pwalczyszyn)
//
//	Licensed under the Apache License, Version 2.0 (the "License");
//	you may not use this file except in compliance with the License.
//	You may obtain a copy of the License at
//
//		http://www.apache.org/licenses/LICENSE-2.0
//
//	Unless required by applicable law or agreed to in writing, software
//	distributed under the License is distributed on an "AS IS" BASIS,
//	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//	See the License for the specific language governing permissions and
//	limitations under the License.
//
//////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////
//
//	Copyright 2012 Piotr Walczyszyn (http://outof.me | @pwalczyszyn)
//
//	Licensed under the Apache License, Version 2.0 (the "License");
//	you may not use this file except in compliance with the License.
//	You may obtain a copy of the License at
//
//		http://www.apache.org/licenses/LICENSE-2.0
//
//	Unless required by applicable law or agreed to in writing, software
//	distributed under the License is distributed on an "AS IS" BASIS,
//	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//	See the License for the specific language governing permissions and
//	limitations under the License.
//
//////////////////////////////////////////////////////////////////////////////////////

/**
 * almond 0.1.1 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license RequireJS text 2.0.0 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*
     * Date Format 1.2.3
     * (c) 2007-2009 Steven Levithan <stevenlevithan.com>
     * MIT license
     *
     * Includes enhancements by Scott Trenda <scott.trenda.net>
     * and Kris Kowal <cixar.com/~kris.kowal/>
     *
     * Accepts a date, a mask, or a date and a mask.
     * Returns a formatted version of the given date.
     * The date defaults to the current date/time.
     * The mask defaults to dateFormat.masks.default.
     */

(function(a,b){typeof define=="function"&&define.amd?define(["jquery"],b):a.CalJS=b(a.jQuery||a.Zepto||a.ender)})(this,function(a){var b,c,d;return function(a){function l(a,b){var c=b&&b.split("/"),d=g.map,e=d&&d["*"]||{},f,h,i,j,k,l,m;if(a&&a.charAt(0)==="."&&b){c=c.slice(0,c.length-1),a=c.concat(a.split("/"));for(k=0;m=a[k];k++)if(m===".")a.splice(k,1),k-=1;else if(m===".."){if(k===1&&(a[2]===".."||a[0]===".."))return!0;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((c||e)&&d){f=a.split("/");for(k=f.length;k>0;k-=1){h=f.slice(0,k).join("/");if(c)for(l=c.length;l>0;l-=1){i=d[c.slice(0,l).join("/")];if(i){i=i[h];if(i){j=i;break}}}j=j||e[h];if(j){f.splice(0,k,j),a=f.join("/");break}}}return a}function m(b,c){return function(){return k.apply(a,i.call(arguments,0).concat([b,c]))}}function n(a){return function(b){return l(b,a)}}function o(a){return function(b){e[a]=b}}function p(b){if(f.hasOwnProperty(b)){var c=f[b];delete f[b],h[b]=!0,j.apply(a,c)}if(!e.hasOwnProperty(b))throw new Error("No "+b);return e[b]}function q(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=l(a.slice(0,e),b),a=a.slice(e+1),d=p(c),d&&d.normalize?a=d.normalize(a,n(b)):a=l(a,b)):a=l(a,b),{f:c?c+"!"+a:a,n:a,p:d}}function r(a){return function(){return g&&g.config&&g.config[a]||{}}}var e={},f={},g={},h={},i=[].slice,j,k;j=function(b,c,d,g){var i=[],j,k,l,n,s,t;g=g||b;if(typeof d=="function"){c=!c.length&&d.length?["require","exports","module"]:c;for(t=0;t<c.length;t++){s=q(c[t],g),l=s.f;if(l==="require")i[t]=m(b);else if(l==="exports")i[t]=e[b]={},j=!0;else if(l==="module")k=i[t]={id:b,uri:"",exports:e[b],config:r(b)};else if(e.hasOwnProperty(l)||f.hasOwnProperty(l))i[t]=p(l);else if(s.p)s.p.load(s.n,m(g,!0),o(l),{}),i[t]=e[l];else if(!h[l])throw new Error(b+" missing "+l)}n=d.apply(e[b],i);if(b)if(k&&k.exports!==a&&k.exports!==e[b])e[b]=k.exports;else if(n!==a||!j)e[b]=n}else b&&(e[b]=d)},b=c=k=function(b,c,d,e){return typeof b=="string"?p(q(b,c).f):(b.splice||(g=b,c.splice?(b=c,c=d,d=null):b=a),c=c||function(){},e?j(a,b,c,d):setTimeout(function(){j(a,b,c,d)},15),k)},k.config=function(a){return g=a,k},d=function(a,b,c){b.splice||(c=b,b=[]),f[a]=[a,b,c]},d.amd={jQuery:!0}}(),d("almond",function(){}),d("Component",[],function(){var b=function(a){this.isTouch="ontouchstart"in window,this.MOUSE_DOWN_EV=this.isTouch?"touchstart":"mousedown",this.MOUSE_MOVE_EV=this.isTouch?"touchmove":"mousemove",this.MOUSE_UP_EV=this.isTouch?"touchend":"mouseup",this.bindHandler=function(b,c){return function(){b.apply(c,Array.prototype.slice.call(arguments))}};var b={};this.on=function(c,d,e){var f=c.split(" ");f.forEach(function(a){var c=b[a],f=!1;c?f=c.some(function(a){return a.handlerFunction===d}):c=b[a]=[],f||c.push({handlerFunction:d,thisObject:e})},this)},this.off=function(c,d){if(typeof c=="undefined")for(var e in b)delete b[e];else{var f=c.split(" ");f.forEach(function(a){typeof d=="undefined"?delete b[a]:b[a].forEach(function(a,b,c){a.handlerFunction===d&&c.splice(b,1)},this)},this)}},this.trigger=function(c,d){if(typeof c!="undefined"){var e=b[c];e&&e.forEach(function(a){var b=typeof a.thisObject!="undefined"?a.thisObject:this;Array.isArray(d)||(d=[d]),a.handlerFunction.apply(b,d)},this)}},this.options=a,this.options&&(this.options.el&&this.setElement(this.options.el),this.options.model&&this.setModel(this.options.model))};return b.prototype.setElement=function(b){b||(b="<div/>"),this.$el=a(b),this.el=this.$el[0]},b.prototype.$=function(a){return this.$el.find(a)},b.prototype.setModel=function(a){this.model=a},b.prototype.render=function(){return this},b}),d("text",["module"],function(a){var b=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],d=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,e=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,g=f&&location.protocol&&location.protocol.replace(/\:/,""),h=f&&location.hostname,i=f&&(location.port||undefined),j=[],k=a.config(),l,m;return l={version:"2.0.0",strip:function(a){if(a){a=a.replace(d,"");var b=a.match(e);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var a,c,d;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(c=0;c<3;c++){d=b[c];try{a=new ActiveXObject(d)}catch(e){}if(a){b=[d];break}}return a},parseName:function(a){var b=!1,c=a.indexOf("."),d=a.substring(0,c),e=a.substring(c+1,a.length);return c=e.indexOf("!"),c!==-1&&(b=e.substring(c+1,e.length),b=b==="strip",e=e.substring(0,c)),{moduleName:d,ext:e,strip:b}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,c,d){var e=l.xdRegExp.exec(a),f,g,h;return e?(f=e[2],g=e[3],g=g.split(":"),h=g[1],g=g[0],(!f||f===b)&&(!g||g===c)&&(!h&&!g||h===d)):!0},finishLoad:function(a,b,c,d){c=b?l.strip(c):c,k.isBuild&&(j[a]=c),d(c)},load:function(a,b,c,d){if(d.isBuild&&!d.inlineText){c();return}k.isBuild=d.isBuild;var e=l.parseName(a),j=e.moduleName+"."+e.ext,m=b.toUrl(j),n=k.useXhr||l.useXhr;!f||n(m,g,h,i)?l.get(m,function(b){l.finishLoad(a,e.strip,b,c)},function(a){c.error&&c.error(a)}):b([j],function(a){l.finishLoad(e.moduleName+"."+e.ext,e.strip,a,c)})},write:function(a,b,c,d){if(j.hasOwnProperty(b)){var e=l.jsEscape(j[b]);c.asModule(a+"!"+b,"define(function () { return '"+e+"';});\n")}},writeFile:function(a,b,c,d,e){var f=l.parseName(b),g=f.moduleName+"."+f.ext,h=c.toUrl(f.moduleName+"."+f.ext)+".js";l.load(g,c,function(b){var c=function(a){return d(h,a)};c.asModule=function(a,b){return d.asModule(a,h,b)},l.write(a,g,c,e)},e)}},typeof process!="undefined"&&process.versions&&!!process.versions.node?(m=c.nodeRequire("fs"),l.get=function(a,b){var c=m.readFileSync(a,"utf8");c.indexOf("ï»¿")===0&&(c=c.substring(1)),b(c)}):l.createXhr()?l.get=function(a,b,c){var d=l.createXhr();d.open("GET",a,!0),k.onXhr&&k.onXhr(d,a),d.onreadystatechange=function(e){var f,g;d.readyState===4&&(f=d.status,f>399&&f<600?(g=new Error(a+" HTTP status: "+f),g.xhr=d,c(g)):b(d.responseText))},d.send(null)}:typeof Packages!="undefined"&&(l.get=function(a,b){var c="utf-8",d=new java.io.File(a),e=java.lang.System.getProperty("line.separator"),f=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(d),c)),g,h,i="";try{g=new java.lang.StringBuffer,h=f.readLine(),h&&h.length()&&h.charAt(0)===65279&&(h=h.substring(1)),g.append(h);while((h=f.readLine())!==null)g.append(e),g.append(h);i=String(g.toString())}finally{f.close()}b(i)}),l}),d("text!WeekView.tpl!strip",[],function(){return"<cj:WeekView>\n\n</cj:WeekView>\n\n"}),d("WeekView",["Component","text!WeekView.tpl!strip"],function(a,b){var c=function(c){c.el=b,a.call(this,c),this.date=c.date};return c.prototype=Object.create(a.prototype),c.prototype.render=function(){return this},c}),d("MonthView",["Component"],function(a){var b=function(b){a.call(this,b)};return b.prototype=Object.create(a.prototype),b.prototype.render=function(){return this},b}),d("text!Calendar.tpl!strip",[],function(){return'<cj:Calendar xmlns:cj="http://caljs.org/1.0">\n    <cj:NavigationBar>\n\n        <cj:NavigationBarLeft>\n            <cj:Button class="btn-prev up"/>\n            <cj:RangeLabel/>\n        </cj:NavigationBarLeft>\n\n        <cj:NavigationBarRight>\n\n        </cj:NavigationBarRight>\n    </cj:NavigationBar>\n</cj:Calendar>'}),d("utils/DateHelper",[],function(){var a=function(){};a.toISO8601=function(a){var b=a.getUTCFullYear(),c=a.getUTCMonth()+1,d=a.getUTCDate(),e=a.getHours(),f=a.getMinutes(),g=a.getSeconds();c=c<10?"0"+c:c,d=d<10?"0"+d:d,e=e<10?"0"+e:e,f=f<10?"0"+f:f,g=g<10?"0"+g:g;var h="-",i=a.getTimezoneOffset();i<0&&(h="+",i=-i);var j=i%60,k=(i-j)/60,l=j<10?"0"+j:""+j,m=k<10?"0"+k:""+k;return b+"-"+c+"-"+d+"T"+e+":"+f+":"+g+".000"+h+""+m+""+l},a.parseISO8601=function(a){if(a==null||a=="")return null;var b="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2})([0-9]{2})))?)?)?)?",c=a.match(new RegExp(b)),d=0,e=new Date(c[1],0,1);return c[3]&&e.setMonth(c[3]-1),c[5]&&e.setDate(c[5]),c[7]&&e.setHours(c[7]),c[8]&&e.setMinutes(c[8]),c[10]&&e.setSeconds(c[10]),c[12]&&e.setMilliseconds(Number("0."+c[12])*1e3),c[14]&&(d=Number(c[16])*60+Number(c[17]),d=c[15]=="-"?d:-d),d-=e.getTimezoneOffset(),e.setTime(e.getTime()+d*60*1e3),e};var b=a.addDays=function(a,b){var c=new Date(a);return c.setDate(a.getDate()+b),c},c=a.firstDayOfWeek=function(a){var c=a.getDay();return c=c==0?-6:c-1,b(a,-c)},d=a.hoursInMs=function(a){return a.getHours()*60*60*1e3+a.getMinutes()*60*1e3+a.getSeconds()*1e3+a.getMilliseconds()},e=a.sameDates=function(a,b){return a.getYear()==b.getYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate()},f=a.lastDayOfWeek=function(a){var c=a.getDay();return c==0||(c=7-c),b(a,c)},g=a.nextWeekFirstDay=function(a){return b(c(a),7)},h=a.prevWeekFirstDay=function(a){return b(c(a),-7)},i=a.nextMonthFirstDay=function(a){var b=new Date(a);return b.setMonth(a.getMonth()+1,1),b},j=a.prevMonthFirstDay=function(a){var b=new Date(a);return b.setMonth(a.getMonth()-1,1),b},k=a.format=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,d=function(a,b){a=String(a),b=b||2;while(a.length<b)a="0"+a;return a};return function(e,f,g){var h=k;arguments.length==1&&Object.prototype.toString.call(e)=="[object String]"&&!/\d/.test(e)&&(f=e,e=undefined),e=e?new Date(e):new Date;if(isNaN(e))throw SyntaxError("invalid date");f=String(h.masks[f]||f||h.masks["default"]),f.slice(0,4)=="UTC:"&&(f=f.slice(4),g=!0);var i=g?"getUTC":"get",j=e[i+"Date"](),l=e[i+"Day"](),m=e[i+"Month"](),n=e[i+"FullYear"](),o=e[i+"Hours"](),p=e[i+"Minutes"](),q=e[i+"Seconds"](),r=e[i+"Milliseconds"](),s=g?0:e.getTimezoneOffset(),t={d:j,dd:d(j),ddd:h.i18n.dayNames[l],dddd:h.i18n.dayNames[l+7],m:m+1,mm:d(m+1),mmm:h.i18n.monthNames[m],mmmm:h.i18n.monthNames[m+12],yy:String(n).slice(2),yyyy:n,h:o%12||12,hh:d(o%12||12),H:o,HH:d(o),M:p,MM:d(p),s:q,ss:d(q),l:d(r,3),L:d(r>99?Math.round(r/10):r),t:o<12?"a":"p",tt:o<12?"am":"pm",T:o<12?"A":"P",TT:o<12?"AM":"PM",Z:g?"UTC":(String(e).match(b)||[""]).pop().replace(c,""),o:(s>0?"-":"+")+d(Math.floor(Math.abs(s)/60)*100+Math.abs(s)%60,4),S:["th","st","nd","rd"][j%10>3?0:(j%100-j%10!=10)*j%10]};return f.replace(a,function(a){return a in t?t[a]:a.slice(1,a.length-1)})}}();return k.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},k.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},a}),d("utils/TouchButtons",[],function(){var b="ontouchstart"in window,c=b?"touchstart":"mousedown",d=b?"touchend":"mouseup";a(document).on(c,"cj\\:Button",function(c){c.preventDefault(),c.stopImmediatePropagation();var e=this,f=a(e);if(b&&c.originalEvent.touches.length==1||!b&&c.which==1)f.removeClass("up down").addClass("active"),a(document).on(d,function(b){b.preventDefault(),b.stopImmediatePropagation(),a(document).off(d,arguments.callee),f.removeClass("active");var c=f.attr("name"),g=c?a("jc\\:Button[name='"+c+"']"):null;if(g)if(g.length>1){var h=!1;g.each(function(){if(this==e)f.hasClass("up")&&(f.removeClass("up"),h=!0),f.hasClass("down")||f.addClass("down");else{var b=a(this);b.hasClass("down")&&b.removeClass("down"),b.hasClass("up")||b.addClass("up")}}),h&&f.trigger("tbclick")}else f.hasClass("down")?f.removeClass("down").addClass("up"):f.removeClass("up").addClass("down"),f.trigger("tbclick");else f.trigger("tbclick")})})}),d("Calendar",["Component","WeekView","MonthView","text!Calendar.tpl!strip","utils/DateHelper","utils/TouchButtons"],function(b,c,d,e,f){var g=function(d){function h(){var a;if(this.currentView instanceof c){var b=f.firstDayOfWeek(this.currentView.date),d=f.lastDayOfWeek(this.currentView.date);b.getMonth()==d.getMonth()?a=f.format(b,"mmmm yyyy"):a=f.format(b,"mmmm")+" - "+f.format(d,"mmmm yyyy")}else a=f.format(this.currentView.date,"mmmm yyyy");this.$calendar.find("cj\\:RangeLabel").html(a)}function i(){var b=f.format(this.currentView.rangeStartDate,"mmm d")+" - "+f.format(this.currentView.rangeEndDate,"mmm d"),c=a("<div/>").html(b).addClass("range-change-message").appendTo(this.$el),d={top:this.$el.height()/2-c.height()/2,left:this.$el.width()/2-c.width()/2};c.css(d).fadeIn(300,function(){a(this).delay(500).fadeOut(300,function(){a(this).remove()})})}function j(){this.currentView.toggleNonWorking()}function k(a){console.log("prevBtn clicked!")}function l(){}function m(a){this.trigger("contextMenu",a)}function n(a){alert("mouse down handle")}d||(d={el:"<div/>"}),b.call(this,d),this.weekView=null,this.monthView=null,this.currentView=null,this.date=d&&d.date?d.date:new Date,this.render=function(){return this.$calendar=a(e),this.$calendar.on("tbclick  cj\\:Button.btn-prev",k),this.weekView=this.currentView=new c({model:this.model,date:this.date}),this.weekView.on(g.RANGE_CHANGED,l,this),this.weekView.on(g.CONTEXT_MENU,m,this),this.weekView.$el.on(this.MOUSE_DOWN_EV,this.bindHandler(n,this)),this.$calendar.append(this.currentView.el),this.currentView.render(),h.call(this),this.$el.html(this.$calendar),this}};return g.RANGE_CHANGED="rangeChanged",g.CONTEXT_MENU="contextMenu",g.prototype=Object.create(b.prototype),g}),{Calendar:c("Calendar")}})